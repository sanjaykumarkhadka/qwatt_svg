<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LED Channel Letter Configurator with Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
            display: flex;
        }
        header {
            background-color: #f8f8f8;
            padding: 15px 0;
            border-bottom: 1px solid #ddd;
        }
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        .tab.active {
            border-bottom: 3px solid #0099ff;
            color: #0099ff;
            font-weight: bold;
        }
        .button-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        .button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .primary-button {
            background-color: #0099ff;
            color: white;
        }
        .secondary-button {
            background-color: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
        }
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-control {
            width: calc(100% - 22px);
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .input-group {
            display: flex;
        }
        .input-group input {
            flex: 1;
            border-radius: 4px 0 0 4px;
        }
        .input-group-append {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-left: none;
            padding: 8px 10px;
            border-radius: 0 4px 4px 0;
            color: #666;
        }
        .main-container {
            display: flex;
            width: 100%;
        }
        .canvas-container {
            border: 1px solid #ddd;
            background-color: #fff;
            width: calc(100% - 300px);
            height: 400px;
            margin-top: 20px;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
        }
        #svgContainer {
            width: 100%;
            height: 100%;
        }
        #svgContainer svg {
            width: 100%;
            height: 100%;
            display: block;
        }
        .toolbar {
            display: flex;
            gap: 10px;
            border: 1px solid #ddd;
            border-bottom: none;
            padding: 10px;
            background-color: #f8f8f8;
        }
        .tool-button {
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        .tool-button:hover {
            background-color: #f0f0f0;
        }
        .quick-start {
            padding: 15px;
            background-color: #f8f8ff;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 20px;
            text-align: center;
        }
        .quick-start a {
            color: #0099ff;
            text-decoration: none;
            font-weight: bold;
        }
        .unit-toggle {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            margin-bottom: 15px;
        }
        .toggle-label {
            margin: 0 10px;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #2196F3;
        }
        input:checked + .slider:before {
            transform: translateX(30px);
        }
        .language-selector {
            display: flex;
            align-items: center;
        }
        .language-selector select {
            margin-left: 10px;
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .results-panel {
            margin-top: 20px;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        .result-card {
            background-color: white;
            padding: 15px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .result-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #0099ff;
        }
        .led-path {
            fill: none;
            stroke: #333;
            stroke-width: 3;
            cursor: move;
        }
        .led-strip {
            fill: #666;
            stroke: none;
            cursor: move;
        }
        .module-count {
            font-size: 14px;
            text-anchor: middle;
            fill: #333;
        }
        .editor-panel {
            width: 300px;
            padding: 20px;
            background-color: #f8f8f8;
            border-left: 1px solid #ddd;
            height: calc(100vh - 60px);
            overflow-y: auto;
        }
        .editor-group {
            margin-bottom: 15px;
        }
        .editor-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .editor-group input[type="color"],
        .editor-group input[type="number"],
        .editor-group select {
            width: 100%;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">Qwatt Technologies</div>
            <div class="unit-toggle">
                <span class="toggle-label">Imperial</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="unitToggle">
                    <span class="slider"></span>
                </label>
                <span class="toggle-label">Metric</span>
                <div class="language-selector">
                    <span>Language:</span>
                    <select id="language">
                        <option value="en">English</option>
                        <option value="es">Español</option>
                        <option value="fr">Français</option>
                    </select>
                </div>
            </div>
        </div>
    </header>
    
    <div class="main-container">
        <div class="container" style="max-width: 900px; margin: 0 auto; padding: 20px; flex: 1;">
            <div class="tabs">
                <div class="tab active">Channel Letter</div>
                <div class="tab">Cabinet</div>
                <div class="tab">Custom Artwork</div>
            </div>
            
            <div class="button-container">
                <button class="button primary-button" id="doItForMeBtn">Do it for me</button>
                <button class="button secondary-button" id="pdfBtn">PDF →</button>
                <button class="button secondary-button" id="detailsBtn">Details</button>
            </div>
            
            <div class="quick-start">
                <a href="#">Quick start for Channel Letter</a>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="layoutType">Layout Type</label>
                    <select id="layoutType" class="form-control">
                        <option>Face Lit</option>
                        <option>Back Lit</option>
                        <option>Halo Lit</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="voltage">Voltage</label>
                    <select id="voltage" class="form-control">
                        <option>24V</option>
                        <option>12V</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="powerSupply">Power Supply</label>
                    <select id="powerSupply" class="form-control">
                        <option>GEPS24LT-100U-NA</option>
                        <option>GEPS12LT-100U-NA</option>
                        <option>GEPS24LT-60U-NA</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="font">Font</label>
                    <select id="font" class="form-control">
                        <option>72 - Black</option>
                        <option>60 - Bold</option>
                        <option>48 - Regular</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="series">Series</label>
                    <select id="series" class="form-control">
                        <option>All</option>
                        <option>MAX Series</option>
                        <option>BASIC Series</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="powerSupplyMode">Power Supply Mode</label>
                    <select id="powerSupplyMode" class="form-control">
                        <option>Simple Optimal</option>
                        <option>Advanced</option>
                        <option>Economy</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="height">Height</label>
                    <div class="input-group">
                        <input type="number" id="height" class="form-control" value="24">
                        <span class="input-group-append" id="heightUnit">in</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="color">Color</label>
                    <select id="color" class="form-control">
                        <option>All</option>
                        <option>Red</option>
                        <option>Green</option>
                        <option>Blue</option>
                        <option>White</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="remotePS">Remote PS</label>
                    <input type="checkbox" id="remotePS" class="form-control" style="width: auto;">
                </div>
                
                <div class="form-group">
                    <label for="depth">Depth</label>
                    <div class="input-group">
                        <input type="number" id="depth" class="form-control" value="5">
                        <span class="input-group-append" id="depthUnit">in</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="module">Module</label>
                    <select id="module" class="form-control">
                        <option>Tetra MAX 24V Small 71K</option>
                        <option>Tetra MAX 24V Medium 71K</option>
                        <option>Tetra MAX 24V Large 71K</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="modulePitch">Module Pitch</label>
                    <div class="input-group">
                        <input type="number" id="modulePitch" class="form-control" value="8">
                        <span class="input-group-append" id="modulePitchUnit">in</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="strokeSpacing">Stroke Spacing</label>
                    <div class="input-group">
                        <input type="number" id="strokeSpacing" class="form-control" value="14">
                        <span class="input-group-append" id="strokeSpacingUnit">in</span>
                    </div>
                </div>
            </div>
            
            <div class="form-group" style="margin-top: 20px;">
                <label for="yourText">Your Text</label>
                <div style="display: flex; gap: 15px;">
                    <input type="text" id="yourText" class="form-control" placeholder="Enter your text here..." style="flex: 1;">
                    <button class="button primary-button" id="populateBtn">Populate</button>
                    <button class="button secondary-button" id="clearBtn">Clear</button>
                </div>
            </div>
            
            <div class="toolbar">
                <div class="tool-button" id="rotateLeft">⟲</div>
                <div class="tool-button" id="rotateRight">⟳</div>
                <div class="tool-button" id="moveUp">↑</div>
                <div class="tool-button" id="moveDown">↓</div>
                <div class="tool-button" id="scaleUp">↻</div>
                <div class="tool-button" id="scaleDown">↺</div>
                <div class="tool-button" id="increaseLeds">🔍+</div>
                <div class="tool-button" id="decreaseLeds">🔍-</div>
                <div class="tool-button" id="clearCanvas">🗑️</div>
            </div>
            
            <div class="canvas-container">
                <div id="svgContainer"></div>
            </div>
            
            <div class="results-panel" id="resultsPanel" style="display: none;">
                <h3>Calculation Results</h3>
                <div class="results-grid">
                    <div class="result-card">
                        <div class="result-title">LED Modules Required</div>
                        <div id="modulesCount">0</div>
                    </div>
                    <div class="result-card">
                        <div class="result-title">Total Stroke Length</div>
                        <div id="strokeLength">0 in</div>
                    </div>
                    <div class="result-card">
                        <div class="result-title">Power Required</div>
                        <div id="powerRequired">0 W</div>
                    </div>
                    <div class="result-card">
                        <div class="result-title">Power Supplies Needed</div>
                        <div id="powerSuppliesCount">0</div>
                    </div>
                    <div class="result-card">
                        <div class="result-title">Recommended Module Spacing</div>
                        <div id="recommendedSpacing">0 in</div>
                    </div>
                    <div class="result-card">
                        <div class="result-title">Circuit Run Length</div>
                        <div id="circuitLength">0 in</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="editor-panel">
            <h3>Editor</h3>
            <div class="editor-group">
                <label for="strokeColor">Stroke Color</label>
                <input type="color" id="strokeColor" value="#333333">
            </div>
            <div class="editor-group">
                <label for="strokeWidth">Stroke Width</label>
                <input type="number" id="strokeWidth" value="3" min="1" max="10">
            </div>
            <div class="editor-group">
                <label for="ledColor">LED Color</label>
                <input type="color" id="ledColor" value="#666666">
            </div>
            <div class="editor-group">
                <label for="ledCount">LED Count per Character</label>
                <input type="number" id="ledCount" value="5" min="1" max="10">
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const unitToggle = document.getElementById('unitToggle');
        const heightUnit = document.getElementById('heightUnit');
        const depthUnit = document.getElementById('depthUnit');
        const strokeSpacingUnit = document.getElementById('strokeSpacingUnit');
        const modulePitchUnit = document.getElementById('modulePitchUnit');
        const yourText = document.getElementById('yourText');
        const svgContainer = document.getElementById('svgContainer');
        const populateBtn = document.getElementById('populateBtn');
        const clearBtn = document.getElementById('clearBtn');
        const resultsPanel = document.getElementById('resultsPanel');
        const modulesCount = document.getElementById('modulesCount');
        const strokeLength = document.getElementById('strokeLength');
        const powerRequired = document.getElementById('powerRequired');
        const powerSuppliesCount = document.getElementById('powerSuppliesCount');
        const recommendedSpacing = document.getElementById('recommendedSpacing');
        const circuitLength = document.getElementById('circuitLength');
        const height = document.getElementById('height');
        const depth = document.getElementById('depth');
        const strokeSpacing = document.getElementById('strokeSpacing');
        const module = document.getElementById('module');

        // Toolbar buttons
        const rotateLeftBtn = document.getElementById('rotateLeft');
        const rotateRightBtn = document.getElementById('rotateRight');
        const moveUpBtn = document.getElementById('moveUp');
        const moveDownBtn = document.getElementById('moveDown');
        const scaleUpBtn = document.getElementById('scaleUp');
        const scaleDownBtn = document.getElementById('scaleDown');
        const increaseLedsBtn = document.getElementById('increaseLeds');
        const decreaseLedsBtn = document.getElementById('decreaseLeds');
        const clearCanvasBtn = document.getElementById('clearCanvas');

        // Editor controls
        const strokeColorInput = document.getElementById('strokeColor');
        const strokeWidthInput = document.getElementById('strokeWidth');
        const ledColorInput = document.getElementById('ledColor');
        const ledCountInput = document.getElementById('ledCount');

        // Transformation state
        let rotation = 0;
        let translateY = 0;
        let scale = 1;
        let ledCountPerChar = 5;

        // Dragging state
        let isDragging = false;
        let currentElement = null;
        let offsetX = 0;
        let offsetY = 0;

        // LED Module Specifications (example data)
        const modules = {
            "Tetra MAX 24V Small 71K": { wattsPerModule: 0.4, recommendedSpacingRatio: 1.8, modulesPerFoot: 3, size: 4 },
            "Tetra MAX 24V Medium 71K": { wattsPerModule: 0.5, recommendedSpacingRatio: 2.2, modulesPerFoot: 2.5, size: 5 },
            "Tetra MAX 24V Large 71K": { wattsPerModule: 0.7, recommendedSpacingRatio: 2.6, modulesPerFoot: 2, size: 6 }
        };

        // Power Supply Specifications
        const powerSupplies = {
            "GEPS24LT-100U-NA": { maxWatts: 100, voltage: 24 },
            "GEPS12LT-100U-NA": { maxWatts: 100, voltage: 12 },
            "GEPS24LT-60U-NA": { maxWatts: 60, voltage: 24 }
        };

        // Updated character paths to match a bold, blocky font style
        const characterPaths = {
            'a': "M20,100 L20,40 L40,40 L40,60 L60,60 L60,40 L80,40 L80,100 L60,100 L60,80 L40,80 L40,100 Z",
            'b': "M20,20 L20,100 L60,100 L60,80 L40,80 L40,60 L60,60 L60,40 L40,40 L40,20 Z",
            'c': "M80,40 C80,20 60,20 40,40 C40,60 60,60 80,60 C80,80 60,80 40,80 C40,100 60,100 80,100",
            'd': "M80,20 L80,100 L40,100 L40,80 L60,80 L60,40 L40,40 L40,20 Z",
            'e': "M80,20 L20,20 L20,100 L80,100 L80,80 L40,80 L40,60 L60,60 L60,40 L40,40 L40,20 Z",
            'f': "M40,20 L40,100 L20,100 L20,20 L60,20 L60,40 L40,40 Z",
            'g': "M80,40 C80,20 60,20 40,20 C20,20 20,40 20,60 L60,60 L60,40 L40,40 L40,80 L60,80 L60,100 L20,100 C20,120 40,120 60,120",
            'h': "M20,20 L20,100 L40,100 L40,60 L60,60 L60,100 L80,100 L80,20 L60,20 L60,40 L40,40 L40,20 Z",
            'i': "M40,20 L40,100 L60,100 L60,20 Z M40,0 L60,0 L60,10 L40,10 Z",
            'j': "M60,20 L60,100 C60,120 40,120 20,120 L20,100 L40,100 L40,20 Z M60,0 L60,10 L40,10 L40,0 Z",
            'k': "M20,20 L20,100 L40,100 L40,60 L60,40 L80,20 L60,60 L40,60 L40,20 Z",
            'l': "M20,20 L20,100 L40,100 L40,20 Z",
            'm': "M20,20 L20,100 L40,100 L40,60 L60,60 L60,100 L80,100 L80,60 L100,60 L100,100 L120,100 L120,20 L100,20 L100,40 L80,40 L80,20 L60,20 L60,40 L40,40 L40,20 Z",
            'n': "M20,20 L20,100 L40,100 L60,40 L60,100 L80,100 L80,20 L60,20 L40,60 L40,20 Z",
            'o': "M40,20 C20,20 20,40 20,60 C20,80 20,100 40,100 C60,100 80,100 80,60 C80,40 60,20 40,20 Z",
            'p': "M20,20 L20,100 L40,100 L40,60 L60,60 L60,40 L40,40 L40,20 Z",
            'q': "M80,20 L80,100 L60,100 L60,60 L40,60 L40,40 L60,40 L60,20 Z M60,100 L80,120",
            'r': "M20,20 L20,100 L40,100 L40,60 L60,40 L80,20 L60,60 L40,60 L40,20 Z",
            's': "M80,20 L20,20 L20,40 L60,40 L60,60 L20,60 L20,80 L80,80 L80,100 L20,100 L20,120 L80,120",
            't': "M20,20 L80,20 L80,40 L60,40 L60,100 L40,100 L40,40 L20,40 Z",
            'u': "M20,20 L20,80 L40,80 L40,100 L60,100 L60,80 L80,80 L80,20 L60,20 L60,60 L40,60 L40,20 Z",
            'v': "M20,20 L40,100 L60,100 L80,20 L60,20 L40,80 L40,20 Z",
            'w': "M20,20 L30,100 L50,100 L60,40 L70,100 L90,100 L100,20 L80,20 L70,80 L60,20 L50,80 L40,20 Z",
            'x': "M20,20 L80,100 L60,100 L40,60 L60,20 Z M80,20 L20,100 L40,100 L60,60 L40,20 Z",
            'y': "M20,20 L40,60 L60,20 L80,20 L60,60 L60,100 L40,100 L40,60 Z",
            'z': "M20,20 L80,20 L80,40 L40,60 L80,80 L80,100 L20,100 L20,80 L60,60 L20,40 Z",
            ' ': ""
        };

        // Function to place LED strips inside the path
        function placeLedStrips(path, svg, ledCount, xOffset, charGroup) {
            const pathLength = path.getTotalLength();
            const spacing = pathLength / (ledCount + 1);
            const strokeWidth = parseFloat(strokeWidthInput.value) || 3;
            const offsetDistance = strokeWidth * 2; // Move LEDs inward by twice the stroke width

            for (let i = 1; i <= ledCount; i++) {
                const position = i * spacing;
                const point = path.getPointAtLength(position);
                const tangent = getTangentAtLength(path, position);
                const angle = Math.atan2(tangent.y, tangent.x) * (180 / Math.PI);

                // Calculate the normal direction (perpendicular to the tangent)
                const magnitude = Math.sqrt(tangent.x * tangent.x + tangent.y * tangent.y);
                const normalX = -tangent.y / magnitude;
                const normalY = tangent.x / magnitude;

                // Offset the position inward
                const offsetX = normalX * offsetDistance;
                const offsetY = normalY * offsetDistance;
                const newX = point.x + offsetX;
                const newY = point.y + offsetY;

                const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                rect.setAttribute("x", newX + xOffset - 5);
                rect.setAttribute("y", newY - 1);
                rect.setAttribute("width", 10);
                rect.setAttribute("height", 2);
                rect.setAttribute("class", "led-strip");
                rect.setAttribute("transform", `rotate(${angle}, ${newX + xOffset}, ${newY})`);
                rect.setAttribute("data-x", newX + xOffset);
                rect.setAttribute("data-y", newY);
                charGroup.appendChild(rect);

                // Add drag event listeners to LED strips
                rect.addEventListener("mousedown", startDragging);
            }
        }

        // Helper function to calculate the tangent at a point on the path
        function getTangentAtLength(path, length) {
            const point1 = path.getPointAtLength(length - 0.01);
            const point2 = path.getPointAtLength(length + 0.01);
            return {
                x: point2.x - point1.x,
                y: point2.y - point1.y
            };
        }

        // Function to render text as SVG paths with LED strips
        function renderTextAsSVG(text) {
            svgContainer.innerHTML = '';

            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");
            svg.setAttribute("preserveAspectRatio", "xMidYMid meet");

            const group = document.createElementNS(svgNS, "g");
            group.setAttribute("transform", `translate(0, ${translateY}) rotate(${rotation}) scale(${scale})`);
            svg.appendChild(group);

            let xOffset = 0;
            const characterSpacing = 20;
            const charWidth = 100 + characterSpacing;

            for (const char of text.toLowerCase()) {
                const pathData = characterPaths[char] || '';
                if (pathData) {
                    const charGroup = document.createElementNS(svgNS, "g");
                    charGroup.setAttribute("data-x", xOffset);
                    charGroup.setAttribute("data-y", 0);
                    group.appendChild(charGroup);

                    const path = document.createElementNS(svgNS, "path");
                    path.setAttribute("d", pathData);
                    path.setAttribute("class", "led-path");
                    path.setAttribute("transform", `translate(${xOffset}, 0)`);
                    charGroup.appendChild(path);

                    // Place LED strips inside the path
                    placeLedStrips(path, svg, ledCountPerChar, xOffset, charGroup);

                    // Add drag event listeners to the character group
                    charGroup.addEventListener("mousedown", startDragging);

                    xOffset += charWidth;
                }
            }

            // Calculate the viewBox based on the content size
            const contentWidth = xOffset;
            const contentHeight = 120;
            const canvasHeightPx = 400;
            const targetHeightInches = 35;
            const pixelsPerInch = canvasHeightPx / targetHeightInches;
            const scaledHeight = contentHeight * pixelsPerInch;
            const scaledWidth = contentWidth * pixelsPerInch;
            svg.setAttribute("viewBox", `0 0 ${contentWidth} ${contentHeight}`);

            svgContainer.appendChild(svg);

            // Update styles based on editor controls
            updateStyles();
        }

        // Function to update styles based on editor controls
        function updateStyles() {
            const paths = document.querySelectorAll(".led-path");
            const leds = document.querySelectorAll(".led-strip");

            paths.forEach(path => {
                path.setAttribute("stroke", strokeColorInput.value);
                path.setAttribute("stroke-width", strokeWidthInput.value);
            });

            leds.forEach(led => {
                led.setAttribute("fill", ledColorInput.value);
            });

            ledCountPerChar = parseInt(ledCountInput.value);
        }

        // Dragging functionality
        function startDragging(e) {
            isDragging = true;
            currentElement = e.target.closest("g") || e.target;
            const transform = currentElement.getAttribute("transform") || "";
            const translateMatch = transform.match(/translate\(([^,]+),([^)]+)\)/);
            offsetX = translateMatch ? parseFloat(translateMatch[1]) : parseFloat(currentElement.getAttribute("data-x") || 0);
            offsetY = translateMatch ? parseFloat(translateMatch[2]) : parseFloat(currentElement.getAttribute("data-y") || 0);
            offsetX -= e.clientX;
            offsetY -= e.clientY;
        }

        function dragElement(e) {
            if (!isDragging) return;
            e.preventDefault();
            const newX = e.clientX + offsetX;
            const newY = e.clientY + offsetY;

            if (currentElement.tagName === "rect") {
                // For LED strips, update position directly
                currentElement.setAttribute("x", newX - 5);
                currentElement.setAttribute("y", newY - 1);
                currentElement.setAttribute("data-x", newX);
                currentElement.setAttribute("data-y", newY);
                // Reset rotation to avoid conflicts
                currentElement.setAttribute("transform", `rotate(0, ${newX}, ${newY})`);
            } else {
                // For character groups, update the transform
                currentElement.setAttribute("transform", `translate(${newX}, ${newY})`);
                currentElement.setAttribute("data-x", newX);
                currentElement.setAttribute("data-y", newY);
            }
        }

        function stopDragging() {
            isDragging = false;
            currentElement = null;
        }

        // Event listeners for dragging
        document.addEventListener("mousemove", dragElement);
        document.addEventListener("mouseup", stopDragging);

        // Event listener for the "Populate" button
        populateBtn.addEventListener("click", () => {
            const text = yourText.value.trim();
            if (text) {
                renderTextAsSVG(text);
            }
        });

        // Event listener for the "Clear" button
        clearBtn.addEventListener("click", () => {
            yourText.value = '';
            svgContainer.innerHTML = '';
            rotation = 0;
            translateY = 0;
            scale = 1;
            ledCountPerChar = 5;
            ledCountInput.value = 5;
        });

        // Toolbar event listeners
        rotateLeftBtn.addEventListener("click", () => {
            rotation -= 15;
            renderTextAsSVG(yourText.value.trim());
        });

        rotateRightBtn.addEventListener("click", () => {
            rotation += 15;
            renderTextAsSVG(yourText.value.trim());
        });

        moveUpBtn.addEventListener("click", () => {
            translateY -= 10;
            renderTextAsSVG(yourText.value.trim());
        });

        moveDownBtn.addEventListener("click", () => {
            translateY += 10;
            renderTextAsSVG(yourText.value.trim());
        });

        scaleUpBtn.addEventListener("click", () => {
            scale *= 1.1;
            renderTextAsSVG(yourText.value.trim());
        });

        scaleDownBtn.addEventListener("click", () => {
            scale /= 1.1;
            renderTextAsSVG(yourText.value.trim());
        });

        increaseLedsBtn.addEventListener("click", () => {
            ledCountPerChar = Math.min(ledCountPerChar + 1, 10);
            ledCountInput.value = ledCountPerChar;
            renderTextAsSVG(yourText.value.trim());
        });

        decreaseLedsBtn.addEventListener("click", () => {
            ledCountPerChar = Math.max(ledCountPerChar - 1, 1);
            ledCountInput.value = ledCountPerChar;
            renderTextAsSVG(yourText.value.trim());
        });

        clearCanvasBtn.addEventListener("click", () => {
            yourText.value = '';
            svgContainer.innerHTML = '';
            rotation = 0;
            translateY = 0;
            scale = 1;
            ledCountPerChar = 5;
            ledCountInput.value = 5;
        });

        // Editor event listeners
        strokeColorInput.addEventListener("input", () => {
            updateStyles();
        });

        strokeWidthInput.addEventListener("input", () => {
            updateStyles();
            renderTextAsSVG(yourText.value.trim()); // Re-render to adjust LED positions
        });

        ledColorInput.addEventListener("input", () => {
            updateStyles();
        });

        ledCountInput.addEventListener("input", () => {
            ledCountPerChar = parseInt(ledCountInput.value);
            renderTextAsSVG(yourText.value.trim());
        });
    </script>
</body>
</html>
